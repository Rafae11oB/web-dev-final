{% extends 'courses/base.html' %}

{% block title %}{{ course.title }} - Online Courses{% endblock %}

{% block content %}
<h1>{{ course.title }}</h1>
<p>{{ course.description }}</p>
<p><strong>Price:</strong> ${{ course.price }}</p>
<p><strong>Category:</strong> {{ course.category.name }}</p>
<p><strong>Instructor:</strong> {{ course.instructor.username }}</p>

{% if user.is_authenticated %}
    {% if user.is_student %}
        <a href="{% url 'make_payment' course.id %}" class="btn btn-success">Enroll Now</a>
    {% endif %}
{% else %}
    <a href="{% url 'login' %}" class="btn btn-success">Login to Enroll</a>
{% endif %}

<hr>

<h2>Lessons</h2>
<ul class="list-group">
    {% for lesson in lessons %}
        <li class="list-group-item">
            <h5>{{ lesson.title }}</h5>
            <p>{{ lesson.content|truncatechars:150 }}</p>
            <a href="{{ lesson.video_url }}" target="_blank" class="btn btn-primary">Watch Video</a>
        </li>
    {% endfor %}
</ul>

<hr>

<h2>Quizzes</h2>
<ul class="list-group">
    {% for quiz in course.quizzes.all %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ quiz.title }}
            <a href="{% url 'take_quiz' quiz.id %}" class="btn btn-secondary btn-sm">Take Quiz</a>
        </li>
    {% empty %}
        <li class="list-group-item">No quizzes available for this course.</li>
    {% endfor %}
</ul>

<hr>

<h2>Reviews</h2>
{% if user.is_authenticated and is_enrolled %}
    {% if not has_reviewed %}
        <a href="{% url 'add_review' course.id %}" class="btn btn-primary mb-3">Leave a Review</a>
    {% else %}
        <p>You have already reviewed this course.</p>
    {% endif %}
{% else %}
    <p><a href="{% url 'login' %}">Login</a> to leave a review.</p>
{% endif %}
<ul class="list-group">
    {% for review in reviews %}
        <li class="list-group-item">
            <strong>{{ review.user.username }}</strong> rated it {{ review.rating }}/5
            <p>{{ review.comment }}</p>
            <small>{{ review.created_at }}</small>
        </li>
    {% empty %}
        <li class="list-group-item">No reviews yet.</li>
    {% endfor %}
</ul>

{% endblock %}
